<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marauder</title>
    <!-- load foundation stuff -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" type="text/css" rel="stylesheet">
    <link href="css/bootstrap-select.min.css" type="text/css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.min.css" type="text/css" rel="stylesheet"><script src="js/vendor/modernizr.js"></script>
    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/bootstrap.min.js"></script>
    <script src="js/vendor/typeahead.bundle.js"></script>
    <script src="js/vendor/bootstrap-select.min.js"></script>

    <!-- load google maps stuff -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <!-- set the map window -->
    <style type="text/css">
            html,body {
  height:100%;
}

h1 {
  font-family: Arial,sans-serif
  font-size:80px;
  color:#DDCCEE;
}

.lead {
  color:#DDCCEE;
}


/* Custom container */
.container-full {
  margin: 0 auto;
  width: 100%;
  min-height:100%;
  background-color:#110022;
  color:#eee;
  overflow:hidden;
}

.container-full a {
  color:#efefef;
  text-decoration:none;
}

.v-center {
  margin-top:2%;
}

.main-icon {
  width: 300px;
}

.typeahead  {
  border-bottom-right-radius: 0;
  border-top-right-radius: 0;
  border-bottom-left-radius: 6px!important;
  border-top-left-radius: 6px!important;
  height: 45px;
}

.twitter-typeahead {
  margin-right: -16px;
  height: 46px;
  vertical-align: middle;
}
.signin-button > button {
  margin-right: 43px;
}
/*.tt-query,
.tt-hint {
    width: 396px;
    height: 30px;
    padding: 8px 12px;
    font-size: 24px;
    line-height: 30px;
    border: 2px solid #ccc;
    -webkit-border-radius: 8px;
    -moz-border-radius: 8px;
    border-radius: 8px;
    outline: none;
}*/

.tt-query {
    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}

.tt-hint {
    color: #000
}

.tt-dropdown-menu {
    width: 229px;
    margin-top: 0px;
    padding: 8px 0;
    background-color: #fff;
    border: 1px solid #ccc;
    border: 1px solid rgba(0, 0, 0, 0.2);
    -webkit-border-radius: 8px;
    -moz-border-radius: 8px;
    border-radius: 8px;
    -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
    -moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
    box-shadow: 0 5px 10px rgba(0,0,0,.2);
    max-height: 150px;
    overflow-y: auto;
}

.tt-suggestion {
    padding: 3px 20px;
    font-size: 18px;
    line-height: 24px;
    color: #333;
}

.tt-suggestion.tt-cursor {
    color: #fff;
    background-color: #428bca;

}

.tt-suggestion p {
    margin: 0;
}

.alert {
  margin-bottom: 0;
  padding: 5px;
}

.invisible {
  show: hidden;
}

.message-area {
  height: 30px;
}


.dropdown-menu {
  color: #333;
}
.dropdown-menu > li > a:hover {
   background-color: #428bca;
}

.select-div {
  height: 40px;
}

.jr-button {
  margin-bottom: 10px;
  margin-left: 2px;
  margin-right: 20px;
  width: 50px;
}
.selectpicker {
  width: 100px;
}

@media screen and (max-width: 768px) {
  .social-icons {
    display: none;
  }
}


      </style>
    </head>


    <body>

        <div class="container-full">

      <div class="row">

        <div class="col-lg-12 text-center v-center">
          <img class="main-icon" src="img/logo.svg">
          <h1>Marauder</h1>
          <p class="lead">Reveal your secrets.</p>

          <br>

          <form class="col-lg-12">
            <div id="signin-cont" class="input-group" style="width:340px;text-align:center;margin:0 auto;">
            <input class="form-control input-lg typeahead" placeholder="Pick or make username" type="text">
              <span class="input-group-btn signin-button"><button class="btn btn-lg btn-primary" type="button"><i class="fa fa-sign-in"></i></button></span>
            </div>
          </form>

          <div class="col-lg-4 col-lg-offset-4 message-area">
            <div class="message v-center alert invisible">
            </div>
          </div>

          <div class="select-div col-md-12 v-center selector-area">

          </div>



        </div>

      </div> <!-- /row -->

      <div class="row social-icons">

        <div class="col-lg-12 text-center v-center" style="font-size:39pt;">
          <a href="#"><i class="icon-google-plus"></i></a> <a href="#"><i class="icon-facebook"></i></a>  <a href="#"><i class="icon-twitter"></i></a> <a href="#"><i class="icon-github"></i></a> <a href="#"><i class="icon-pinterest"></i></a>
        </div>

      </div>


</div> <!-- /container full -->
<!--
<div class="container">

    <hr>

    <div class="row">
        <div class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading"><h3>Hello.</h3></div>
            <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
            Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
            dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
            Aliquam in felis sit amet augue.
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading"><h3>Hello.</h3></div>
            <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
            Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
            dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
            Aliquam in felis sit amet augue.
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading"><h3>Hello.</h3></div>
            <div class="panel-body">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis pharetra varius quam sit amet vulputate.
            Quisque mauris augue, molestie tincidunt condimentum vitae, gravida a libero. Aenean sit amet felis
            dolor, in sagittis nisi. Sed ac orci quis tortor imperdiet venenatis. Duis elementum auctor accumsan.
            Aliquam in felis sit amet augue.
            </div>
          </div>
        </div>
    </div>

  <div class="row">
        <div class="col-lg-12">
        <br><br>
          <p class="pull-right"><a href="http://www.bootply.com">Template from Bootply</a> &nbsp; Â©Copyright 2013 ACME<sup>TM</sup> Brand.</p>
        <br><br>
        </div>
    </div>
</div> -->








        <!-- JavaScript jQuery code from Bootply.com editor -->

        <script type='text/javascript'>
        var preloaded_players = {}
        $(document).ready(function() {
           $('.selectpicker').selectpicker();
          var substringMatcher = function(strs) {
            return function findMatches(q, cb) {
              var matches, substringRegex;

              // an array that will be populated with substring matches
              matches = [];

              // regex used to determine if a string contains the substring `q`
              substrRegex = new RegExp(q, 'i');

              // iterate through the pool of strings and for any string that
              // contains the substring `q`, add it to the `matches` array
              $.each(strs, function(i, str) {
                if (substrRegex.test(str.substring(0,str.indexOf('-')))) {
                  // the typeahead jQuery plugin expects suggestions to a
                  // JavaScript object, refer to typeahead docs for more info
                  matches.push({ value: str });
                }
              });

              cb(matches);
            };
          };

          var url = "maps/all_players";
          $.getJSON(url, function(players) {
            playernames = [];
            console.log(players);
            for (player_index in players) {
              player_obj = players[player_index]
              player_string = player_obj.player_name+"-"+player_obj.player_id;
              playernames.push(player_string);
              preloaded_players[player_string] = true;
            }
            $('.typeahead').typeahead({
              hint: true,
              highlight: true,
              minLength: 0
            },
            {
              name: 'states',
              displayKey: 'value' ,
              source: substringMatcher(playernames)
            });
          });

        });
        $('.typeahead').keyup(function(eve) {
          $(this).attr("placeholder","");
          $('.selector-area').html("");
        });
        $('.signin-button').click(function(eve) {
          var name = $('.tt-input')[0].value;
          if (name.length == 0) {
            // NOTHING ENTERED
            $('.message').text("You haven't entered anything!")
            $('.message').removeClass('invisible alert-danger alert-success alert-info');
            $('.message').addClass('alert-danger');
            $('.selector-area').html("");
            console.log("nothing entered");
          }
          else if (name in preloaded_players) {
            // PREEXISTING PLAYER
            $('.message').text("You've chosen a pre-existing player!")
            $('.message').removeClass('invisible alert-danger alert-success alert-info');
            $('.message').addClass('alert-success');
            $('.selector-area').html("");
            console.log("preloaded_players");
            var playerid = name.substring(name.indexOf('-')+1).valueOf();
            var url = "maps/"+playerid+"/map_players";
            console.log(url);
            $.getJSON(url, function(all_maps) {

              maps = all_maps["join"];
              var options = "";
              if (maps.length > 0) {
                for (map_ind in maps) {
                  var map = maps[map_ind];
                  var option = "<option id=\""+map.map_id+"\">"+map.map_name+"</option>";
                  options += option;
                }
                var selector = "<select data-width=\"200px\" class=\"selectpicker join-picker\" data-style=\"btn-success\">" + options + "</select>";
                selector += "<button type=\"submit\" class=\"join-button jr-button btn btn-success\"><i class=\"fa fa-plus\"></button>";
                $('.selector-area').append(selector);
              }

              maps = all_maps["resume"];
              var options = "";
              if (maps.length > 0) {
                for (map_ind in maps) {
                  var map = maps[map_ind];
                  var option = "<option id=\""+map.map_id+"\">"+map.map_name+"</option>";
                  options += option;
                }
                var selector = "<select data-width=\"200px\" class=\"selectpicker resume-picker\" data-style=\"btn-warning\">" + options + "</select>";
                selector += "<button type=\"submit\" class=\"resume-button jr-button btn btn-warning\"><i class=\"fa fa-play\"></button>";
                $('.selector-area').append(selector);

                $('.selectpicker').selectpicker();
              }
              $('.join-button').click(function() {
                var map_id = $(".join-picker option:selected").attr("id");

                var player = $('.tt-input').val();
                var player_id = player.substring(player.indexOf('-')+1);
                $('<form />')
                  .hide()
                  .attr({ method : "post" })
                  .attr({ action : "/signin"})
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "map_id" })
                    .val(map_id)
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "entry" })
                    .val("join")
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player" })
                    .val("old")
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player_id" })
                    .val(player_id)
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player_name" })
                    .val(player)
                  )
                  .append('<input type="submit" />')
                  .appendTo($("body"))
                  .submit();
              });
              $('.resume-button').click(function() {
                var map_id = $(".resume-picker option:selected").attr("id");
                var player = $('.tt-input').val();
                var player_id = player.substring(player.indexOf('-')+1);
                $('<form />')
                  .hide()
                  .attr({ method : "post" })
                  .attr({ action : "maps/"+map_id})
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "entry" })
                    .val("resume")
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player" })
                    .val("old")
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player_id" })
                    .val(player_id)
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player_name" })
                    .val(player)
                  )
                  .append('<input type="submit" />')
                  .appendTo($("body"))
                  .submit();
              });
            });
          } else {
            // CREATING NEW PLAYER
            $('.message').text("You will be creating a new player!")
            $('.message').removeClass('invisible alert-danger alert-success alert-info');
            $('.message').addClass('alert-info');
            $('.selector-area').html("");
            console.log("new player");
            var url = "maps/all_maps";

            $.getJSON(url, function(maps) {
              console.log(maps);
              var options = "";
              for (map_ind in maps) {
                var map = maps[map_ind];
                var option = "<option id=\""+map.map_id+"\">"+map.map_name+"</option>";
                options += option;
              }
              var selector = "<select data-width=\"200px\"  class=\"selectpicker join-picker\" data-style=\"btn-success\">" + options + "</select>";
              selector += "<button type=\"submit\" class=\"join-button jr-button btn btn-success\"><i class=\"fa fa-plus\"></button>";
              $('.selector-area').append(selector);
              $('.selectpicker').selectpicker();

              $('.join-button').click(function() {
                var map_id = $(".join-picker option:selected").attr("id");
                var player = $('.tt-input').val();
                var player_id = player.substring(player.indexOf('-')+1);
                $('<form />')
                  .hide()
                  .attr({ method : "post" })
                  .attr({ action : "/signin"})
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "map_id" })
                    .val(map_id)
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "entry" })
                    .val("join")
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player" })
                    .val("new")
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player_id" })
                    .val(player_id)
                  )
                  .append($('<input />')
                    .attr("type","hidden")
                    .attr({ "name" : "player_name" })
                    .val(player)
                  )
                  .append('<input type="submit" />')
                  .appendTo($("body"))
                  .submit();
              });
            });
          }

        });
        </script>
  </body>
</html>
